objTypes["arcinterface"]={p_name:"折射率",create:function(e){return{obj:{type:"arcinterface",p1:e,p2:graphs.point(e.x+gridSize,e.y),p:1.2},draggingPart:{part:2}}},draw:function(e,t){var n=t.getContext("2d");n.fillStyle="rgb(255,0,255)";if(e.p3){var r=graphs.intersection_2line(graphs.perpendicular_bisector(graphs.line(e.p1,e.p3)),graphs.perpendicular_bisector(graphs.line(e.p2,e.p3)));var i=graphs.length(r,e.p3);var s=Math.atan2(e.p1.y-r.y,e.p1.x-r.x);var o=Math.atan2(e.p2.y-r.y,e.p2.x-r.x);var u=Math.atan2(e.p3.y-r.y,e.p3.x-r.x);var a=o<u&&u<s||s<o&&o<u||u<s&&s<o;n.strokeStyle="rgba(192,192,192,0.5)";n.lineWidth=4;n.beginPath();n.arc(r.x,r.y,a?i-2:i+2,s,o,a);n.stroke();n.strokeStyle="rgba(128,128,255,0.5)";n.lineWidth=4;n.beginPath();n.arc(r.x,r.y,a?i+2:i-2,s,o,a);n.stroke();n.strokeStyle="rgba(0,0,0,255)";n.lineWidth=.5;n.beginPath();n.arc(r.x,r.y,i,s,o,a);n.stroke();n.fillRect(e.p3.x-2,e.p3.y-2,3,3);n.lineWidth=1}n.fillStyle="rgb(255,0,0)";n.fillRect(e.p1.x-2,e.p1.y-2,3,3);n.fillRect(e.p2.x-2,e.p2.y-2,3,3)},move:function(e,t,n){e.p1.x=e.p1.x+t;e.p1.y=e.p1.y+n;e.p2.x=e.p2.x+t;e.p2.y=e.p2.y+n;e.p3.x=e.p3.x+t;e.p3.y=e.p3.y+n;return e},clicked:function(e,t){if(!e.p3){e.p3=t;return{obj:e,draggingPart:{part:3}}}if(mouseOnPoint(t,e.p1)){return{draggingPart:{part:1}}}if(mouseOnPoint(t,e.p2)){return{draggingPart:{part:2}}}if(mouseOnPoint(t,e.p3)){return{draggingPart:{part:3}}}var n=graphs.intersection_2line(graphs.perpendicular_bisector(graphs.line(e.p1,e.p3)),graphs.perpendicular_bisector(graphs.line(e.p2,e.p3)));var r=graphs.length(n,e.p3);var i=Math.atan2(e.p1.y-n.y,e.p1.x-n.x);var s=Math.atan2(e.p2.y-n.y,e.p2.x-n.x);var o=Math.atan2(e.p3.y-n.y,e.p3.x-n.x);var u=Math.atan2(t.y-n.y,t.x-n.x);if(Math.abs(graphs.length(n,t)-r)<8&&(s<o&&o<i||i<s&&s<o||o<i&&i<s)==(s<u&&u<i||i<s&&s<u||u<i&&i<s)){return{draggingPart:{part:0,mouse1:t}}}return false},dragging:function(e,t,n){if(n.part==1){e.p1=t;return{obj:e}}if(n.part==2){e.p2=t;return{obj:e}}if(n.part==3){e.p3=t;return{obj:e}}if(n.part==0){var r=n.mouse1.x-t.x;var i=n.mouse1.y-t.y;e.p1.x=e.p1.x-r;e.p1.y=e.p1.y-i;e.p2.x=e.p2.x-r;e.p2.y=e.p2.y-i;e.p3.x=e.p3.x-r;e.p3.y=e.p3.y-i;return{obj:e,draggingPart:{part:0,mouse1:t}}}},rayIntersection:function(e,t){if(!e.p3){return}var n=graphs.intersection_2line(graphs.perpendicular_bisector(graphs.line(e.p1,e.p3)),graphs.perpendicular_bisector(graphs.line(e.p2,e.p3)));var r=graphs.length(n,e.p3);var i=Math.atan2(e.p1.y-n.y,e.p1.x-n.x);var s=Math.atan2(e.p2.y-n.y,e.p2.x-n.x);var o=Math.atan2(e.p3.y-n.y,e.p3.x-n.x);var u=graphs.intersection_line_circle(graphs.line(t.p1,t.p2),graphs.circle(n,e.p2));var a;var f=[];var l=[];for(var c=1;c<=2;c++){a=Math.atan2(u[c].y-n.y,u[c].x-n.x);f[c]=(s<o&&o<i||i<s&&s<o||o<i&&i<s)==(s<a&&a<i||i<s&&s<a||a<i&&i<s)&&graphs.length(u[c],t.p1)>graphs.length(u[c],t.p2);l[c]=graphs.length(t.p1,u[c])}if(f[1]&&(!f[2]||l[1]<l[2])){return u[1]}if(f[2]&&(!f[1]||l[2]<l[1])){return u[2]}},shot:function(e,t){var n=graphs.intersection_2line(graphs.perpendicular_bisector(graphs.line(e.p1,e.p3)),graphs.perpendicular_bisector(graphs.line(e.p2,e.p3)));var r=this.rayIntersection(e,t);var i=Math.atan2(e.p1.y-n.y,e.p1.x-n.x);var s=Math.atan2(e.p2.y-n.y,e.p2.x-n.x);var o=Math.atan2(e.p3.y-n.y,e.p3.x-n.x);var u=s<o&&o<i||i<s&&s<o||o<i&&i<s;var a=Math.atan2(r.y-n.y,r.x-n.x)-Math.PI/2;if(a<=-Math.PI){a=a+Math.PI*2}var f=Math.atan2(t.p1.y-r.y,t.p1.x-r.x);var l=a>=0&&a>f&&f>a-Math.PI||a<0&&(f<a||f>a+Math.PI);if(l){var c=a-Math.PI/2}else{var c=a+Math.PI/2}if(l!=u){var h=e.p}else{var h=1/e.p}if(Math.abs(Math.sin(c-f)*h)>1){var p=c*2-f}else{var p=c+Math.PI-Math.asin(Math.sin(c-f)*h)}return graphs.ray(r,graphs.point(r.x+Math.cos(p),r.y+Math.sin(p)))}}
